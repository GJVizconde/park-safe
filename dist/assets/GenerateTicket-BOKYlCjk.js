import{i as x}from"./index-CziqjtLO.js";import{a as u,_ as E}from"./axios-p9E6UbiB.js";import{_ as B,B as D}from"./ButtonForm-DXeJfFCX.js";import{_ as m,g as $}from"./goTo-DUxel0Nq.js";import{d as F,r as o,l as P,b as g,w as h,c as R,e as s,a as V,F as z,g as G,o as M}from"./index-DUFCv0zT.js";const N={class:"px-5"},O={class:"flex justify-center items-center mt-[50px]"},q=F({__name:"GenerateTicket",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(y){const r=o("https://park-safe-api.onrender.com/api"),n=o({name:"",id:"",email:"",role:"",hasTicket:"",token:""}),t=o({userId:"",vehicleId:"",parkingId:"",collaboratorId:""}),p=o([{id:0,name:"",email:"",password:"",role:"USER",vehicles:[]}]),I=G(),i=P(y,"modelValue"),v=o(),_=o(),d=o(!0),b=o(!0),f=o([""]),T=()=>{w(t.value)},U=()=>{x.success("El vehÃ­culo ha ingresado al estacionamiento!",{theme:"colored",autoClose:2e3,onClose:()=>{$(I,"ticket-control")},position:"bottom-center"})},C=async()=>{try{const e=(await u.get(`${r.value}/user?ticket=false&hasVehicle=true`)).data;p.value=e,b.value=!1}catch(e){console.error("Error al obtener el ticket:",e)}},w=async e=>{try{const a=(await u.post(`${r.value}/ticket/`,e,{headers:{"X-Timezone-Offset":new Date().getTimezoneOffset()}})).data;_.value=a,U()}catch(a){console.error("Error al generar el ticket: ",a)}},S=async()=>{try{const e=(await u.get(`${r.value}/parking?available=true`)).data;f.value=e}catch(e){console.log("Error al obtener el ticket: ",e)}},c=()=>{};return g(async()=>{await C(),await S()}),g(()=>{const e=localStorage.getItem("userSession");n.value=e?JSON.parse(e):{name:"",id:"",email:"",role:"",hasTicket:!1,token:""}}),h(t.value,e=>{},{deep:!0}),h(i,e=>{var a;t.value.userId=e.id,v.value=e.vehicles,t.value.collaboratorId=n.value.id,d.value=!((a=e==null?void 0:e.vehicles[0])!=null&&a.id)},{deep:!0}),(e,a)=>{var k;return M(),R(z,null,[s(E,{title:"Generar Ticket"}),V("section",N,[s(m,{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=l=>i.value=l),onChange:c,label:"Usuario:",placeholder:"Seleccionar Usuario","data-options":p.value,typeData:"user",disabled:!!b.value},null,8,["modelValue","data-options","disabled"]),s(m,{modelValue:t.value.vehicleId,"onUpdate:modelValue":a[1]||(a[1]=l=>t.value.vehicleId=l),onChange:c,label:"Placa:","data-options":v.value,typeData:"vehicle",disabled:d.value},null,8,["modelValue","data-options","disabled"]),s(m,{modelValue:t.value.parkingId,"onUpdate:modelValue":a[2]||(a[2]=l=>t.value.parkingId=l),onChange:c,label:"Lugar de estacionamiento:","data-options":f.value,typeData:"parking",disabled:d.value},null,8,["modelValue","data-options","disabled"]),s(B,{modelValue:t.value.collaboratorId,"onUpdate:modelValue":a[3]||(a[3]=l=>t.value.collaboratorId=l),id:"collaborator",name:"collaborator",label:"Empleado",placeholder:"Colaborador",value:(k=n.value)==null?void 0:k.name,type:"text",disabled:"",class:"text-gray-500"},null,8,["modelValue","value"])]),V("div",O,[s(D,{label:"Generar ticket",buttonType:"inputForm",size:"standard-form",onClick:T})])],64)}}});export{q as default};

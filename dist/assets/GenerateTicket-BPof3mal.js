import{i as T}from"./index-B1-6Nd2h.js";import{a as p,_ as w}from"./axios-cMcX0P3F.js";import{_ as x,B}from"./ButtonForm-ZvVUSRbb.js";import{_ as v,g as D}from"./goTo-t69S6qUI.js";import{d as $,r as l,l as F,b as k,w as h,c as N,e as s,a as f,F as M,g as P,o as R}from"./index-C60wjN5s.js";const G={class:"px-5"},L={class:"flex justify-center items-center mt-[50px]"},q=$({__name:"GenerateTicket",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(V){const r=l("https://park-safe-api.onrender.com/api"),n=l({name:"",id:"",email:"",role:"",hasTicket:"",token:""}),o=l({userId:"",vehicleId:"",parkingId:"",collaboratorId:""}),i=l([{id:0,name:"",email:"",password:"",role:"USER",vehicles:[]}]),y=P(),c=F(V,"modelValue"),g=l(),I=l(),d=l(!0),u=l([""]),_=()=>{console.log("Me hicierón click"),E(o.value)},U=()=>{T.success("El vehículo ha ingresado al estacionamiento!",{theme:"colored",autoClose:2e3,onClose:()=>{D(y,"ticket-control")},position:"bottom-center"})},C=async()=>{try{const e=(await p.get(`${r.value}/user`)).data;console.log(e),i.value=e,console.log("users => ",i.value)}catch(e){console.error("Error al obtener el ticket:",e)}},E=async e=>{try{const a=(await p.post(`${r.value}/ticket/`,e)).data;console.log(a),I.value=a,U()}catch(a){console.error("Error al generar el ticket: ",a)}},S=async()=>{try{const e=(await p.get(`${r.value}/parking?available=true`)).data;u.value=e,console.log("Lugares disponibles =>",u.value)}catch(e){console.log("Error al obtener el ticket: ",e)}},m=()=>{console.log("Se hizo un cambioo")};return k(async()=>{await C(),await S()}),k(()=>{const e=localStorage.getItem("userSession");n.value=e?JSON.parse(e):{name:"",id:"",email:"",role:"",hasTicket:!1,token:""}}),h(o.value,e=>{console.log("FormData has changed",e)},{deep:!0}),h(c,e=>{var a;console.log("NUEVO valor de model ==>>",e),console.log("NUEVO valor de value.vehicles ==>>",e.vehicles),o.value.userId=e.id,g.value=e.vehicles,o.value.collaboratorId=n.value.id,d.value=!((a=e==null?void 0:e.vehicles[0])!=null&&a.id)},{deep:!0}),(e,a)=>{var b;return R(),N(M,null,[s(w,{title:"Generar Ticket"}),f("section",G,[s(v,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=t=>c.value=t),onChange:m,label:"Usuario:","data-options":i.value,typeData:"user"},null,8,["modelValue","data-options"]),s(v,{modelValue:o.value.vehicleId,"onUpdate:modelValue":a[1]||(a[1]=t=>o.value.vehicleId=t),onChange:m,label:"Placa:","data-options":g.value,typeData:"vehicle",disabled:d.value},null,8,["modelValue","data-options","disabled"]),s(v,{modelValue:o.value.parkingId,"onUpdate:modelValue":a[2]||(a[2]=t=>o.value.parkingId=t),onChange:m,label:"Lugar de estacionamiento:","data-options":u.value,typeData:"parking",disabled:d.value},null,8,["modelValue","data-options","disabled"]),s(x,{modelValue:o.value.collaboratorId,"onUpdate:modelValue":a[3]||(a[3]=t=>o.value.collaboratorId=t),id:"collaborator",name:"collaborator",label:"Empleado",placeholder:"Colaborador",value:(b=n.value)==null?void 0:b.name,type:"text",disabled:"",class:"text-gray-500"},null,8,["modelValue","value"])]),f("div",L,[s(B,{label:"Generar ticket",buttonType:"inputForm",size:"standard-form",onClick:_})])],64)}}});export{q as default};
